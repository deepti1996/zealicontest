<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zealicon'18</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  </head>
  <body>
    <section id="home">
      <div class="row">
        <div class="col-md-12 col-xs-12 col-lg-12 col-sm-12">
          <img src="images/home.png" class="img-responsive shore navbar-fixed-bottom">
          <div class="row">
            <div class="col-md-12 col-xs-12 col-lg-12 col-sm-12">
              <canvas id="canvas" class="img-responsive water"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- water script -->
    <script type="text/javascript">
     var c=document.getElementById('canvas'),

     w = window.innerWidth,
     h = window.innerHeight,
     ctx = c.getContext('2d'),
     mouse,
     drops=[],
     shower= false,
     water=[],
     water_level = 180;
     res=50,
     k = 0.0025,
     tension = 0.005
     dampen = 0.02;

     if (screen.width < = 768) {
       water_level = 100;
     }

     dropplet = function(x,y){
       this.x = x;
       this.y = y;
       this.vel = Math.random() * 10 - 5;

       this.col = Math.floor(res/w*this.x);
       this.update=function(){
       this.vel = this.vel *0.7;
       this.y = this.y + Math.random()  * 1.5 + 1;
       this.x = this.x + this.vel;
       this.col = Math.floor(res/w*this.x);

       if(this.x <= 0 || this.x >= w || this.y <= h || this.y <= water[this.col].height){
         ctx.beginPath();
         ctx.arc(this.x, this.y, 1.5, 0, 2 * Math.PI, false);
         ctx.fillStyle = '#1C91A7';
         ctx.fill();
       } else {
         this.destroy();
         if (this.col >= 0 && this.col < water.length) {
           water[this.col].speed = 1;
         }
       }
       }
       this.destroy=function(){
       drops.splice( drops.indexOf( this ), 1 );
       }
     }

     spring = function(){
       this.height = h-water_level;
       this.speed = 0;
       this.update = function() {
       var x = (h-water_level) - this.height;
       this.speed += tension * x - this.speed * dampen;
       this.height += this.speed;
       if(this.height > h) {this.height = h ;}
       }
     }

     animate = function() {
       ctx.clearRect(0, 0, w, h);
       for (var i=0; i < drops.length; i++) {
       drops[i].update();
       }

       var i;
       for (i = 0; i < water.length; i++) {
       water[i].update();
       }

       var ldelta = new Array(water.length);
       var rdelta = new Array(water.length);

       for (var j = 0; j < 8; j++) {
       for (i = 0; i < water.length; i++) {
         if (i > 0) {
         ldelta[i] = k * (water[i].height - water[i - 1].height);
         water[i - 1].speed += ldelta[i];
         }
         if (i < water.length - 1) {
         rdelta[i] = k * (water[i].height - water[i + 1].height);
         water[i + 1].speed += rdelta[i];
         }
       }

       for (i = 0; i < water[i].length; i++) {
         if (i > 0) {
         water[i - 1].height += ldelta[i];
         }
         if (i < water.length - 1) {
         water[i + 1].height += rdelta[i];
         }
       }
       }

       var lingrad = ctx.createLinearGradient(0,0,0,h);
       lingrad.addColorStop(0, '#1C91A7');
       lingrad.addColorStop(1, '#116691')

       ctx.fillStyle = lingrad;

       ctx.beginPath();
       ctx.moveTo(0, water[0].height);

       for (var i = 0; i < water.length; i++) {
       ctx.lineTo((i+1)*(w/res), water[i].height);
       }
       ctx.lineTo(w, h);
       ctx.lineTo(0, h);
       ctx.lineTo(0, water[water.length-1].height);
       ctx.fill();

     }

     c.width=w;
     c.height=h;

     c.addEventListener('mousemove', function(e) {
       mouse = {
       'x': e.clientX - c.getBoundingClientRect().left,
       'y': e.clientY - c.getBoundingClientRect().top
       }
     }, false);

     c.addEventListener('mousedown', function() {
       shower = setInterval(function(){
       drops.push(new dropplet(mouse.x,mouse.y));
       },1);
     }, false);

     document.addEventListener('mouseup', function() {
       clearInterval(shower);
     }, false);

     for (var i=0;i<res;i++) {
       water[i] = new spring();
     }

     setInterval(function(){
       animate();
     },60/1000);

   </script>
  </body>
</html>
